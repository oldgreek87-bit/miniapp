# Bookflix - Обзор проекта

## Что это

Bookflix — это Telegram Mini App для английского книжного клуба с подпиской. Пользователи могут покупать подписку, читать книги месяца, получать доступ к закрытому каналу и читать клубный журнал.

## Основные страницы

### Для пользователей

1. **Главная страница**
   - Книга месяца (по умолчанию)
   - Журнал (доступен через свайп)
   - Кнопки: "Купить подписку", "Моя подписка", "Reading Room"
   - Разворачивающиеся секции "О чём книга" и "О чём журнал"

2. **Экран покупки подписки**
   - Один план: 1 месяц - 299₽
   - Интеграция с T-Bank (в тестовом режиме)

3. **Экран "Моя подписка"**
   - Статус подписки (Активна/Неактивна)
   - Осталось дней
   - Даты начала и окончания
   - Кнопка отмены подписки

4. **Экран "Reading Room"**
   - Проверка доступа к закрытому каналу
   - Ссылка для входа (если подписка активна)
   - Сообщение об истёкшей подписке (если неактивна)

5. **Экран подтверждения оплаты**
   - Показывается после успешной оплаты

### Для администраторов

1. **Админ панель - вкладка "Контент"**
   - Управление книгой месяца (месяц, год, название, автор, описание, изображение)
   - Управление журналом (номер, название, описания, изображение)

2. **Админ панель - вкладка "Пользователи"**
   - Список всех пользователей (включая неактивных)
   - Информация: имя, фото, username, ID
   - Статус подписки
   - Добавление дней к подписке

## API Endpoints

### Публичные (без авторизации)

- `GET /api/book-of-month` — получить текущую книгу месяца
- `GET /api/magazine/latest` — получить последний журнал
- `GET /api/subscription-status?user_id=<id>` — статус подписки пользователя
- `GET /api/reading-room-access?user_id=<id>` — проверка доступа к каналу
- `POST /api/create-payment` — создать платёжную сессию
- `POST /api/confirm-payment` — подтвердить платёж
- `POST /api/cancel-subscription` — отменить подписку

### Админ (требует токен)

- `GET /api/admin/users?admin_token=<token>` — список всех пользователей
- `POST /api/admin/book-of-month` — обновить книгу месяца
- `POST /api/admin/magazine` — обновить журнал
- `POST /api/admin/add-days` — добавить дни к подписке
- `POST /api/admin/set-subscription` — установить статус подписки

### Системные

- `GET /api/health` — проверка работоспособности API
- `POST /api/cron` — ежедневная задача управления каналом (требует CRON_SECRET)

## База данных

### Таблицы

1. **subscriptions**
   - `user_id` — Telegram ID пользователя (уникальный)
   - `subscription_start` — дата начала подписки
   - `subscription_end` — дата окончания подписки
   - `subscription_status` — статус (active/inactive/cancelled)
   - `payment_id` — ID платежа

2. **payment_history**
   - `user_id` — Telegram ID
   - `payment_id` — уникальный ID платежа
   - `amount` — сумма
   - `days` — количество дней подписки
   - `status` — статус (pending/completed/failed)

3. **book_of_month**
   - `month` — месяц (1-12)
   - `year` — год
   - `title` — название книги
   - `author` — автор
   - `description` — полное описание
   - `image_url` — URL изображения

4. **monthly_magazine**
   - `issue_number` — номер выпуска (уникальный)
   - `title` — название журнала
   - `short_description` — краткое описание
   - `full_description` — полное описание
   - `image_url` — URL изображения

5. **messages** (для будущего чата)
   - `user_id` — Telegram ID
   - `message_text` — текст сообщения
   - `is_from_user` — от пользователя (1) или от админа (0)
   - `created_at` — время создания

## Что видят пользователи

1. **При открытии приложения:**
   - Логотип Bookflix
   - Подзаголовок "английский книжный клуб"
   - Книга месяца с изображением
   - Текст "регулярно читаем книги на английском" и "прокачиваем словарный запас"
   - Кнопка "О чём книга" (разворачивается)
   - Подсказка о свайпе

2. **После свайпа влево:**
   - Журнал с изображением
   - Краткое описание журнала
   - Кнопка "О чём журнал" (разворачивается)

3. **Кнопки внизу:**
   - Купить подписку
   - Моя подписка
   - Reading Room

## Что видят администраторы

1. **Вкладка "Контент":**
   - Форма для книги месяца (все поля заполняются автоматически текущими данными)
   - Форма для журнала (все поля заполняются автоматически)
   - Кнопки "Сохранить" для каждой формы

2. **Вкладка "Пользователи":**
   - Таблица со всеми пользователями
   - Колонки: Пользователь (с фото и именем), Статус, Даты, Осталось дней, Действия
   - Кнопка "Добавить дни" для каждого пользователя

## Технические детали

- **Frontend:** HTML, CSS, JavaScript (ванильный JS)
- **Backend:** Node.js, Express (Vercel Serverless Functions)
- **База данных:** SQLite (в `/tmp` на Vercel, временная)
- **Платежи:** T-Bank API (в тестовом режиме, mock реализация)
- **Telegram:** Bot API для управления каналом
- **Деплой:** Vercel
- **Язык:** Русский (кроме "Reading Room")

## Особенности

- ✅ Только один план подписки (1 месяц)
- ✅ Свайп между книгой и журналом
- ✅ Разворачивающиеся секции описаний
- ✅ Управление контентом через админ панель
- ✅ Автоматическое управление доступом к каналу (cron)
- ✅ Показ всех пользователей в админке (включая неактивных)
- ✅ Информация о пользователях из Telegram (имя, фото, username)

