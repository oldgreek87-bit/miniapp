# Bookflix - Telegram Mini App

Английский книжный клуб с подпиской, книгой месяца и журналом.

## Особенности

- ✅ **Книга месяца** - главная страница с текущей книгой
- ✅ **Журнал** - Bookflix Monthly с разворачивающимся описанием
- ✅ **Свайп** - переключение между книгой и журналом
- ✅ **Подписка** - покупка подписки на 1 месяц
- ✅ **Reading Room** - доступ к закрытому каналу
- ✅ **Админ панель** - управление контентом и пользователями

## Структура проекта

```
miniapp/
├── index.html          # Главная страница (книга + журнал)
├── style.css           # Стили
├── script.js           # Логика фронтенда
├── admin.html          # Админ панель
├── admin.js            # Логика админ панели
├── logo.svg            # Логотип
├── book-of-month.png   # Изображение книги месяца
├── magazine-22.png     # Изображение журнала
├── package.json        # Зависимости
├── vercel.json         # Конфигурация Vercel
├── api/
│   ├── index.js        # Консолидированный API
│   ├── db.js           # База данных
│   ├── payment.js      # Платежи
│   ├── subscription.js # Подписки
│   └── telegram.js     # Telegram Bot API
└── .gitignore
```

## Быстрый старт

1. **Установите зависимости:**
   ```bash
   npm install
   ```

2. **Настройте переменные окружения** (в Vercel Dashboard):
   ```
   TELEGRAM_BOT_TOKEN=your_token
   TELEGRAM_CHANNEL_ID=your_channel_id
   CHANNEL_INVITE_LINK=https://t.me/your_channel
   ADMIN_SECRET_TOKEN=your_admin_token
   CRON_SECRET=your_cron_secret
   ```

3. **Инициализируйте данные** (опционально):
   ```bash
   node init-december-data.js
   ```

4. **Загрузите в GitHub и деплойте на Vercel**

## Админ панель

Доступ: `https://your-app.vercel.app/admin.html?token=YOUR_ADMIN_TOKEN`

### Управление контентом

1. **Книга месяца:**
   - Выберите месяц и год
   - Введите название, автора, описание
   - Укажите URL изображения (или путь к файлу)
   - Сохраните

2. **Журнал:**
   - Введите номер выпуска
   - Введите название, краткое и полное описание
   - Укажите URL изображения
   - Сохраните

### Управление пользователями

- Просмотр всех пользователей (включая неактивных)
- Добавление дней к подписке
- Просмотр информации о пользователях (имя, фото)

## API Endpoints

### Публичные
- `GET /api/book-of-month` - получить текущую книгу месяца
- `GET /api/magazine/latest` - получить последний журнал
- `POST /api/create-payment` - создать платёж
- `POST /api/confirm-payment` - подтвердить платёж
- `GET /api/subscription-status` - статус подписки
- `GET /api/reading-room-access` - доступ к Reading Room

### Админ
- `GET /api/admin/users` - список пользователей
- `POST /api/admin/book-of-month` - обновить книгу месяца
- `POST /api/admin/magazine` - обновить журнал
- `POST /api/admin/add-days` - добавить дни подписки

## База данных

Таблицы:
- `subscriptions` - подписки пользователей
- `payment_history` - история платежей
- `messages` - сообщения (для чата)
- `book_of_month` - книги месяца
- `monthly_magazine` - журналы

## Особенности интерфейса

- **Свайп** - проведите пальцем по книге/журналу для переключения
- **Разворачивающиеся секции** - нажмите "О чём книга/журнал" для просмотра описания
- **Адаптивный дизайн** - оптимизировано для мобильных устройств

## Деплой

1. Загрузите код в GitHub
2. Подключите репозиторий к Vercel
3. Установите переменные окружения
4. Деплойте

## Примечания

- База данных использует SQLite в `/tmp` на Vercel (временная)
- Для production рекомендуется PostgreSQL
- T-Bank интеграция в тестовом режиме (mock)
- Изображения должны быть загружены в репозиторий или доступны по URL

